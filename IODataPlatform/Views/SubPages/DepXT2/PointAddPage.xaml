<Page x:Class="IODataPlatform.Views.SubPages.DepXT2.PointAddPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:local="clr-namespace:IODataPlatform.Views.SubPages.DepXT2"
      mc:Ignorable="d" 
      ui:NavigationView.HeaderContent="æ·»åŠ ç‚¹"
      d:DesignHeight="700" d:DesignWidth="900"
      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
      d:DataContext="{d:DesignInstance local:PointAddPage, IsDesignTimeCreatable=False}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <RowDefinition Height="*"/>
            <!-- å†…å®¹åŒº -->
            <RowDefinition Height="Auto"/>
            <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
        </Grid.RowDefinitions>

        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ (åªæœ‰3æ­¥) -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,30">
            <!-- æ­¥éª¤ 1: é€‰æ‹©Excel -->
            <Border BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" 
                    BorderThickness="2" 
                    CornerRadius="50" 
                    Width="40" Height="40"
                    Background="{Binding ViewModel.Step1Background}">
                <TextBlock Text="{Binding ViewModel.Step1Number}" FontSize="18" FontWeight="Bold" 
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           Foreground="{Binding ViewModel.Step1Foreground}"/>
            </Border>
            <TextBlock Text="é€‰æ‹©Excel" VerticalAlignment="Center" Margin="8,0,20,0"
                       FontWeight="{Binding ViewModel.Step1FontWeight}"/>

            <ui:SymbolIcon Symbol="ChevronRight24" VerticalAlignment="Center" Margin="0,0,20,0"/>

            <!-- æ­¥éª¤ 2: æ ¡éªŒæ•°æ® -->
            <Border BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" 
                    BorderThickness="2" 
                    CornerRadius="50" 
                    Width="40" Height="40"
                    Background="{Binding ViewModel.Step2Background}">
                <TextBlock Text="{Binding ViewModel.Step2Number}" FontSize="18" FontWeight="Bold" 
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           Foreground="{Binding ViewModel.Step2Foreground}"/>
            </Border>
            <TextBlock Text="æ ¡éªŒæ•°æ®" VerticalAlignment="Center" Margin="8,0,20,0"
                       FontWeight="{Binding ViewModel.Step2FontWeight}"/>

            <ui:SymbolIcon Symbol="ChevronRight24" VerticalAlignment="Center" Margin="0,0,20,0"/>

            <!-- æ­¥éª¤ 3: ç”Ÿæˆé¢„è§ˆ -->
            <Border BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" 
                    BorderThickness="2" 
                    CornerRadius="50" 
                    Width="40" Height="40"
                    Background="{Binding ViewModel.Step3Background}">
                <TextBlock Text="{Binding ViewModel.Step3Number}" FontSize="18" FontWeight="Bold" 
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           Foreground="{Binding ViewModel.Step3Foreground}"/>
            </Border>
            <TextBlock Text="ç”Ÿæˆé¢„è§ˆ" VerticalAlignment="Center" Margin="8,0,0,0"
                       FontWeight="{Binding ViewModel.Step3FontWeight}"/>
        </StackPanel>

        <!-- å†…å®¹åŒº -->
        <ui:CardControl Grid.Row="1">
            <Grid>
                <!-- æ­¥éª¤ 1: é€‰æ‹©Excelæ–‡ä»¶å’ŒSheet -->
                <Grid Visibility="{Binding ViewModel.Step1Visibility}" Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="é€‰æ‹©æ•°æ®æº" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    
                    <!-- ç›®æ ‡æœºæŸœæç¤º -->
                    <Border Grid.Row="0" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{DynamicResource AccentFillColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="12,8"
                            Margin="0,0,0,20">
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Info24" FontSize="16" Margin="0,0,8,0" Foreground="{DynamicResource AccentFillColorDefaultBrush}"/>
                            <TextBlock Text="{Binding ViewModel.Step1StatusText}" 
                                       Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                       TextWrapping="Wrap"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- æ–‡ä»¶é€‰æ‹©åŒº -->
                    <ui:CardControl Grid.Row="1" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <ui:SymbolIcon Symbol="Document24" FontSize="20" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                <TextBlock Text="æ–‡ä»¶è·¯å¾„" FontWeight="SemiBold" VerticalAlignment="Center" Width="80"/>
                                <TextBox Text="{Binding ViewModel.SelectedFilePath}" 
                                         IsReadOnly="True" 
                                         Width="500" 
                                         Margin="0,0,10,0"
                                         VerticalAlignment="Center"/>
                                <ui:Button Icon="{ui:SymbolIcon FolderOpen24}" 
                                           Content="æµè§ˆ" 
                                           Appearance="Primary"
                                           Command="{Binding ViewModel.BrowseFileCommand}"/>
                            </StackPanel>

                            <!-- å·¥ä½œè¡¨é€‰æ‹© -->
                            <Border BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1 0 0 0"
                                    Padding="0,15,0,0"
                                    Visibility="{Binding ViewModel.SheetSelectionVisibility}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                        <ui:SymbolIcon Symbol="TableSimple24" FontSize="20" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="é€‰æ‹©å·¥ä½œè¡¨" FontWeight="SemiBold" VerticalAlignment="Center" Width="80"/>
                                        <ComboBox ItemsSource="{Binding ViewModel.SheetNames}" 
                                                  SelectedItem="{Binding ViewModel.SelectedSheet}"
                                                  Width="300"
                                                  Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding ViewModel.SheetCountText}" 
                                                   VerticalAlignment="Center"
                                                   Foreground="Gray"/>
                                    </StackPanel>
                                    
                                    <ui:Button Content="åŠ è½½é¢„è§ˆ" 
                                               Icon="{ui:SymbolIcon Eye24}"
                                               Command="{Binding ViewModel.LoadPreviewCommand}"
                                               Appearance="Secondary"
                                               HorizontalAlignment="Right"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ui:CardControl>

                    <!-- æ•°æ®é¢„è§ˆåŒº -->
                    <ui:CardControl Grid.Row="2" Margin="0,0,0,15" Visibility="{Binding ViewModel.PreviewVisibility}">
                        <Grid Margin="15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <ui:SymbolIcon Symbol="DataBarVertical24" FontSize="20" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                <TextBlock Text="æ•°æ®é¢„è§ˆ" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,20,0"/>
                                <TextBlock Text="{Binding ViewModel.PreviewDataCountText}" 
                                           VerticalAlignment="Center" 
                                           Foreground="#1976D2"
                                           FontWeight="Bold"/>
                            </StackPanel>

                            <DataGrid Grid.Row="1" 
                                      ItemsSource="{Binding ViewModel.ExcelPreviewData}"
                                      AutoGenerateColumns="True"
                                      IsReadOnly="True"
                                      MaxHeight="300"
                                      CanUserSortColumns="True"
                                      HeadersVisibility="Column"
                                      GridLinesVisibility="Horizontal"
                                      AlternatingRowBackground="{DynamicResource ControlFillColorInputActiveBrush}"/>
                        </Grid>
                    </ui:CardControl>

                    <!-- çŠ¶æ€ä¿¡æ¯ -->
                    <StackPanel Grid.Row="3" Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Info24" FontSize="16" Margin="0,0,8,0" Foreground="Gray"/>
                        <TextBlock Text="{Binding ViewModel.Step2StatusText}" 
                                   Foreground="Gray"
                                   TextWrapping="Wrap"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

                <!-- æ­¥éª¤ 2: æ•°æ®æ ¡éªŒ -->
                <Grid Visibility="{Binding ViewModel.Step2Visibility}" Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="æ•°æ®æ ¡éªŒç»“æžœ" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,20"/>
                    
                    <!-- æ ¡éªŒç»“æžœå¡ç‰‡ -->
                    <ui:CardControl Grid.Row="1" Margin="0,0,0,20">
                        <StackPanel Margin="20">
                            <!-- æ ¡éªŒç»“æžœä¿¡æ¯ -->
                            <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="15"
                                    Margin="0,0,0,20">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                        <ui:SymbolIcon Symbol="CheckmarkCircle24" FontSize="20" Margin="0,0,10,0" 
                                                       Foreground="#4CAF50" VerticalAlignment="Center"/>
                                        <TextBlock Text="æ ¡éªŒç»“æžœ" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding ViewModel.ValidationResult}" 
                                               TextWrapping="Wrap"
                                               FontFamily="Cascadia Code, Consolas"
                                               FontSize="12"
                                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>
                            </Border>

                            <!-- æŠ¥è­¦ç±»åž‹é€‰æ‹© -->
                            <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="15">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                        <ui:SymbolIcon Symbol="Options24" FontSize="20" Margin="0,0,10,0" 
                                                       Foreground="{DynamicResource AccentFillColorDefaultBrush}" VerticalAlignment="Center"/>
                                        <TextBlock Text="é€‰æ‹©æŠ¥è­¦ç±»åž‹" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <StackPanel>
                                        <RadioButton Content="ðŸ“¡ é€šè®¯æŠ¥è­¦ï¼ˆåˆ†é…åˆ°é¢„ç•™æ¿å¡ï¼‰" 
                                                     IsChecked="{Binding ViewModel.IsCommunicationAlarm}"
                                                     Margin="0,0,0,10"
                                                     FontSize="13"/>
                                        <TextBlock Text="â€¢ ä½¿ç”¨é¢„ç•™æ¿å¡è¿›è¡Œé€šè®¯æŠ¥è­¦ä¿¡å·åˆ†é…" 
                                                   FontSize="11" 
                                                   Foreground="Gray" 
                                                   Margin="28,0,0,15"/>
                                        
                                        <RadioButton Content="ðŸ”Œ ç¡¬ç‚¹æŠ¥è­¦ï¼ˆå¯é€‰åˆ†é…åˆ°çŽ°æœ‰æ¿å¡ï¼‰" 
                                                     IsChecked="{Binding ViewModel.IsHardwareAlarm}"
                                                     FontSize="13"/>
                                        <TextBlock Text="â€¢ å¯é€‰æ‹©åˆ†é…åˆ°çŽ°æœ‰æ¿å¡æˆ–æ”¾å…¥æœªåˆ†é…åˆ—è¡¨" 
                                                   FontSize="11" 
                                                   Foreground="Gray" 
                                                   Margin="28,0,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ui:CardControl>
                </Grid>

                <!-- æ­¥éª¤ 3: ç”Ÿæˆé¢„è§ˆ -->
                <StackPanel Visibility="{Binding ViewModel.Step3Visibility}" Margin="20">
                    <TextBlock Text="æŠ¥è­¦ç‚¹ç”Ÿæˆé¢„è§ˆ" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,20"/>
                    
                    <DataGrid ItemsSource="{Binding ViewModel.PreviewData}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              Height="400"
                              CanUserSortColumns="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="æœºæŸœåç§°" Binding="{Binding æœºæŸœåç§°}" Width="100"/>
                            <DataGridTextColumn Header="ä¿¡å·ä½å·" Binding="{Binding SignalNumber}" Width="150"/>
                            <DataGridTextColumn Header="æè¿°" Binding="{Binding ä¿¡å·æè¿°}" Width="200"/>
                            <DataGridTextColumn Header="åˆ†é…çŠ¶æ€" Binding="{Binding åˆ†é…çŠ¶æ€}" Width="100"/>
                            <DataGridTextColumn Header="åˆ†é…ä½ç½®" Binding="{Binding åˆ†é…ä½ç½®}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    
                    <TextBlock Text="{Binding ViewModel.PreviewSummary}" 
                               Margin="0,15,0,0"
                               Foreground="Gray"/>
                </StackPanel>
            </Grid>
        </ui:CardControl>

        <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <ui:Button Content="ä¸Šä¸€æ­¥" 
                       Command="{Binding ViewModel.PreviousStepCommand}"
                       Appearance="Secondary"
                       Visibility="{Binding ViewModel.PreviousButtonVisibility}"
                       Margin="0,0,10,0"/>
            <ui:Button Content="ä¸‹ä¸€æ­¥" 
                       Command="{Binding ViewModel.NextStepCommand}"
                       Appearance="Primary"
                       Visibility="{Binding ViewModel.NextButtonVisibility}"
                       Margin="0,0,10,0"/>
            <ui:Button Content="å®Œæˆ" 
                       Command="{Binding ViewModel.FinishCommand}"
                       Appearance="Success"
                       Visibility="{Binding ViewModel.FinishButtonVisibility}"
                       Margin="0,0,10,0"/>
            <ui:Button Content="å–æ¶ˆ" 
                       Command="{Binding ViewModel.CancelCommand}"/>
        </StackPanel>
    </Grid>
</Page>
