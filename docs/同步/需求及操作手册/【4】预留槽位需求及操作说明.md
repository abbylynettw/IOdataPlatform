# 预留槽位需求及操作说明

## 一、需求文档

### 功能目标
我需要在执行IO分配前，为每个机柜的最后一个机笼配置预留插槽。这些预留插槽用于放置通讯板卡或报警板卡，预留后的插槽在IO自动分配时会被跳过，确保这些位置留给特定用途的板卡。

### 触发时机
点击"IO分配"按钮后，如果检测到有机柜，会先弹出预留槽位配置窗口，用户配置完成后再继续执行IO自动分配。

### 1. 机柜列表规则
- 显示当前子项目所有已配置的机柜
- 每个机柜一行，显示机柜名称
- 默认所有机柜都不启用预留（IsSelected = false）
- 如果之前已配置过预留，会自动加载之前的配置

### 2. 预留插槽配置规则

#### 启用/禁用预留
- 每个机柜可以独立选择是否启用预留
- 勾选"启用预留"后，才能添加预留插槽配置
- 取消勾选后，该机柜的预留配置不生效（但不删除配置，下次勾选还能看到）

#### 添加预留插槽
- 点击"添加预留插槽"按钮（+号），为该机柜添加一个预留插槽
- 可以添加多个预留插槽（每个占用最后一个机笼的一个插槽位置）
- 预留插槽从后往前分配：第1个预留占用倒数第1个槽位，第2个预留占用倒数第2个槽位，以此类推

#### 板卡类型选择
每个预留插槽需要选择板卡类型：
- MD211：通讯板卡（MD211通讯模块）
- MD216：通讯板卡（MD216通讯模块）
- DP211：DP通讯板卡

#### 预留目的选择
每个预留插槽需要指定预留目的（通过点击图标切换）：
- 通讯预留（蓝色插头图标）：用于通讯板卡预留
- 报警预留（橙色警告图标）：用于机柜报警模块预留

#### 删除预留插槽
- 点击每个插槽配置右侧的删除按钮（×），删除该预留插槽
- 删除后该槽位在IO分配时可以被使用

### 3. 配置保存规则
- 配置完成点击"确定并继续IO分配"后，配置会保存
- 下次再执行IO分配时，会自动加载上次的预留配置
- 配置保存在内存中，与机柜清单关联

### 4. 验证规则
确认前会校验：
- 如果勾选了"启用预留"但没有添加任何预留插槽，提示"请点击'添加预留插槽'按钮"
- 如果有预留插槽未选择板卡类型，提示"有插槽未选择板卡类型，请选择"
- 验证通过后才能继续执行IO分配

### 5. IO分配中的处理规则
- 预留的插槽在IO自动分配时会被占用，但不会放置实际的IO信号
- 预留插槽会生成对应的板卡记录，标记为"预留板卡"
- 后续如果需要手动调整，可以在这些预留位置放置实际的通讯或报警板卡

### 6. 取消操作
- 点击"取消"按钮，不保存配置，直接退出
- 如果取消，IO分配操作也会中止

---

## 二、用户手册

### 操作步骤

#### 第一步：触发预留配置
1. 在IO清单页面，确保已有机柜数据
2. 点击"IO分配"按钮
3. 系统自动弹出"预留插槽配置"窗口

#### 第二步：选择需要预留的机柜
1. 浏览机柜列表，找到需要配置预留的机柜
2. 勾选该机柜行的"启用预留"复选框
3. 可以为多个机柜分别配置预留

#### 第三步：添加预留插槽
1. 点击机柜右侧的"添加预留插槽"按钮（+号）
2. 在弹出的插槽配置中选择板卡类型（MD211/MD216/DP211）
3. 点击图标切换预留目的（通讯/报警）
4. 如需多个预留插槽，重复点击"+"按钮

#### 第四步：确认配置
1. 检查所有机柜的预留配置是否正确
2. 确认每个预留插槽的板卡类型和预留目的
3. 点击"确定并继续IO分配"按钮
4. 系统自动继续执行IO分配

### 配置示例

**示例1：机柜预留1个通讯插槽**
- 机柜：3ACKC001AR
- 启用预留：勾选
- 插槽1：MD211，通讯预留

**示例2：机柜预留2个插槽（1个通讯+1个报警）**
- 机柜：3ACKC002AR
- 启用预留：勾选
- 插槽1：MD211，通讯预留
- 插槽2：MD211，报警预留

**示例3：不需要预留**
- 机柜：3ACKC003AR
- 启用预留：不勾选

### 注意事项

1. **预留位置固定**：预留插槽始终在最后一个机笼，从后往前占用槽位，无法指定具体槽位号

2. **配置可修改**：预留配置保存后，下次执行IO分配时还会弹出配置窗口，可以修改之前的配置

3. **不影响已分配数据**：修改预留配置后，需要重新执行IO分配才能生效，不会自动更新已分配的数据

4. **预留数量限制**：预留插槽数量不能超过最后一个机笼的总槽位数，否则IO分配时会报错

5. **板卡类型要准确**：选择的板卡类型应与实际要放置的板卡一致，影响后续的硬件对应

6. **预留目的的作用**：
   - **通讯预留**：用于通讯板卡，后续可能用于网络通讯、协议转换等
   - **报警预留**：用于机柜报警模块，与机柜报警功能关联

### 常见问题

**问题1：点击IO分配后没弹出预留配置窗口**
- 原因：当前子项目没有机柜数据
- 解决：先配置机柜清单，再执行IO分配

**问题2：提示"请点击'添加预留插槽'按钮"**
- 原因：勾选了"启用预留"但没有添加任何预留插槽
- 解决：点击+号按钮至少添加1个预留插槽，或取消勾选"启用预留"

**问题3：不知道选择哪种板卡类型**
- 原因：不了解各板卡类型的用途
- 解决：
  - MD211：常规通讯模块，适用于大多数场景
  - MD216：16通道通讯模块，适用于通道数较多的场景
  - DP211：DP总线通讯模块，适用于DP网络

**问题4：预留目的"通讯"和"报警"有什么区别**
- 原因：不清楚两种预留目的的用途
- 解决：
  - 通讯预留：用于一般的通讯板卡，如网络通讯、数据交换等
  - 报警预留：专门用于机柜报警模块，与机柜报警表功能关联

**问题5：预留配置错了怎么办**
- 原因：已经配置并确认了，发现配置有误
- 解决：重新点击"IO分配"按钮，会再次弹出预留配置窗口，修改后重新确认

**问题6：可以为一个机柜预留多少个插槽**
- 原因：不确定预留数量上限
- 解决：理论上可以预留多个，但不能超过最后一个机笼的总槽位数（通常为16个）。建议预留1-3个即可，预留太多会浪费槽位资源

**问题7：取消后还能继续IO分配吗**
- 原因：点击了"取消"按钮
- 解决：点击"取消"后整个IO分配操作会中止。如果需要继续，重新点击"IO分配"按钮

**问题8：预留配置会持久化保存吗**
- 原因：担心关闭程序后配置丢失
- 解决：目前配置保存在内存中，与机柜清单关联。每次执行IO分配都会弹出配置窗口，可以查看和修改之前的配置
